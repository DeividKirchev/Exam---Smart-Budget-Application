<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>5</epicId>
    <storyId>5.1</storyId>
    <title>Implement Responsive Navigation</title>
    <status>drafted</status>
    <generatedAt>2025-11-16</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>.bmad-ephemeral/stories/5-1-responsive-navigation.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>a user on any device</asA>
    <iWant>navigation that adapts to my screen size</iWant>
    <soThat>I can easily access all features on mobile and desktop</soThat>
    <tasks>
      - Task 1: Install Lucide React for icons (AC: #1, #2)
        - 1.1: Run `npm install lucide-react`
        - 1.2: Verify lucide-react appears in package.json dependencies

      - Task 2: Create useMediaQuery custom hook (AC: #1)
        - 2.1: Create file `/src/hooks/useMediaQuery.ts`
        - 2.2: Implement hook using `window.matchMedia` API
        - 2.3: Add TypeScript interface for hook return type
        - 2.4: Test hook returns correct boolean for breakpoints

      - Task 3: Update Navigation component for responsive behavior (AC: #1, #2, #3, #4)
        - 3.1: Import useMediaQuery hook and Lucide Menu/X icons
        - 3.2: Add state for mobile menu open/closed (`isMenuOpen`)
        - 3.3: Detect mobile breakpoint using `useMediaQuery('(max-width: 767px)')`
        - 3.4: Conditionally render hamburger icon on mobile
        - 3.5: Conditionally render horizontal nav on tablet/desktop
        - 3.6: Implement `toggleMenu` function to handle hamburger click
        - 3.7: Implement `closeMenu` function for outside clicks and nav link selection
        - 3.8: Add Escape key listener to close mobile menu
        - 3.9: Add click outside handler using refs

      - Task 4: Style mobile menu with Tailwind CSS (AC: #1, #2)
        - 4.1: Add slide-in animation using Tailwind transition classes
        - 4.2: Add overlay backdrop for mobile menu
        - 4.3: Style hamburger icon with appropriate size (44x44px tap target)
        - 4.4: Style mobile menu container (full height, slide from left)
        - 4.5: Apply smooth transition (300ms) to menu open/close

      - Task 5: Implement accessibility features (AC: #3)
        - 5.1: Add `aria-label="Toggle navigation menu"` to hamburger button
        - 5.2: Add `aria-expanded={isMenuOpen}` to hamburger button
        - 5.3: Add `aria-controls="mobile-menu"` to hamburger button
        - 5.4: Add `id="mobile-menu"` to mobile nav container
        - 5.5: Ensure all nav links have visible focus states
        - 5.6: Test keyboard navigation (Tab through links, Enter to activate)

      - Task 6: Highlight active route in navigation (AC: #3)
        - 6.1: Use `useLocation()` hook from react-router-dom
        - 6.2: Compare current path to nav link paths
        - 6.3: Apply active styling (e.g., bg-blue-100, font-bold) to active link
        - 6.4: Ensure active styling visible in both mobile and desktop views

      - Task 7: Test responsive navigation on all breakpoints (AC: #1, #2, #4)
        - 7.1: Test at 320px (mobile): hamburger visible, menu slides in
        - 7.2: Test at 767px (mobile max): hamburger visible
        - 7.3: Test at 768px (tablet min): horizontal nav visible
        - 7.4: Test at 1023px (tablet max): horizontal nav with compact spacing
        - 7.5: Test at 1024px (desktop): full horizontal nav bar
        - 7.6: Verify all tap targets ≥44x44px on mobile (Chrome DevTools)
        - 7.7: Test menu closes on outside click
        - 7.8: Test menu closes on Escape key
        - 7.9: Test menu closes when nav link clicked
    </tasks>
  </story>

  <acceptanceCriteria>
    AC-5.1.1: Breakpoint-Based Navigation
    - Desktop (≥1024px): Horizontal nav bar with all links visible
    - Tablet (768-1023px): Horizontal nav visible with compact spacing
    - Mobile (≤767px): Hamburger menu icon visible, horizontal nav hidden

    AC-5.1.2: Mobile Menu Behavior
    - Hamburger icon toggles mobile menu open/closed
    - Menu slides in from left with smooth animation (≤300ms)
    - Clicking outside menu closes it
    - Pressing Escape key closes menu
    - Selecting a nav link closes menu and navigates

    AC-5.1.3: Accessibility
    - All nav links keyboard accessible (Tab, Enter)
    - Hamburger button has aria-label: "Toggle navigation menu"
    - Hamburger button has aria-expanded attribute reflecting menu state
    - Active route visually highlighted in navigation

    AC-5.1.4: Touch Targets
    - All nav links ≥44x44px tap target size on mobile
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path=".bmad-ephemeral/stories/tech-spec-epic-5.md" title="Epic 5 Technical Specification" section="Story 5.1: Responsive Navigation Workflow">
        Story 5.1 workflow details responsive navigation implementation: User loads on mobile (≤767px), Navigation detects viewport using useMediaQuery, renders hamburger icon, menu slides in from left with animation, closes on outside click/Escape/nav selection. Desktop (≥1024px) shows full horizontal nav bar.
      </doc>

      <doc path="docs/architecture.md" title="System Architecture" section="Technology Stack Details - UI & Styling">
        Tailwind CSS 4.0 utility-first CSS framework with Lucide React icon library (tree-shakeable, modern). Responsive Design uses mobile-first approach with Tailwind breakpoints (sm: 640px, md: 768px, lg: 1024px, xl: 1280px).
      </doc>

      <doc path="docs/architecture.md" title="System Architecture" section="Component Patterns">
        Functional components with TypeScript. Use React hooks (useState, useEffect). Custom hooks pattern for reusable logic. Event handlers: handle prefix (handleSubmit, handleDelete). State setters: set prefix. Custom hooks: use prefix (useTransactions, usePeriod).
      </doc>

      <doc path="docs/architecture.md" title="System Architecture" section="Project Structure">
        Navigation component located at src/components/layout/Navigation.tsx. Custom hooks in src/hooks/ directory. Tailwind CSS configured in tailwind.config.js. Icons from Lucide React library.
      </doc>

      <doc path="docs/PRD.md" title="Product Requirements Document" section="FR-5.1: Mobile Responsiveness">
        Application must be fully responsive across mobile (≤767px), tablet (768-1023px), and desktop (≥1024px). All UI elements must adapt smoothly. Touch targets on mobile must be ≥44x44px for accessibility (NFR-4.1).
      </doc>

      <doc path="docs/PRD.md" title="Product Requirements Document" section="NFR-4.3: Accessibility">
        Application must meet WCAG AA accessibility standards including keyboard navigation (Tab, Enter, Escape), ARIA labels for screen readers, and sufficient color contrast (4.5:1 ratio). All interactive elements must be accessible without mouse.
      </doc>
    </docs>

    <code>
      <artifact path="src/hooks" kind="directory" symbol="hooks" lines="" reason="Location for custom React hooks including useMediaQuery to be created in this story">
      </artifact>

      <artifact path="src/components/layout/Navigation.tsx" kind="component" symbol="Navigation" lines="" reason="Primary component to be modified for responsive behavior with hamburger menu and breakpoint detection">
      </artifact>

      <artifact path="tailwind.config.js" kind="config" symbol="tailwindConfig" lines="" reason="Tailwind CSS configuration with breakpoints (sm: 640px, md: 768px, lg: 1024px, xl: 1280px) - use default breakpoints, no modifications needed">
      </artifact>

      <artifact path="package.json" kind="config" symbol="dependencies" lines="" reason="Verify lucide-react is added after npm install, check react-router-dom exists for useLocation hook">
      </artifact>
    </code>

    <dependencies>
      <node>
        <package name="lucide-react" version="^0.469.0" status="TO_INSTALL">Icon library for Menu and X icons in hamburger menu</package>
        <package name="react" version="^18.3.0" status="INSTALLED">Core React library - use useState, useEffect, useRef hooks</package>
        <package name="react-router-dom" version="^6.30.0" status="INSTALLED">Routing library - use useLocation hook for active route detection</package>
        <package name="tailwindcss" version="^4.0.0" status="INSTALLED">CSS framework - use responsive utilities (md:, lg: prefixes) and transition classes</package>
        <package name="typescript" version="~5.6.0" status="INSTALLED">Type definitions for all components and hooks</package>
      </node>
    </dependencies>
  </artifacts>

  <constraints>
    - Component-based architecture: All UI enhancements must be encapsulated in reusable components
    - Separation of concerns: Styling via Tailwind classes only, no inline styles or CSS-in-JS
    - Consistent naming: PascalCase for components (Navigation.tsx), camelCase for functions (toggleMenu, closeMenu), use prefix for custom hooks (useMediaQuery)
    - Type safety: All new components and hooks must be fully typed with TypeScript interfaces
    - Mobile-first responsive design: Base styles for mobile, use md: and lg: prefixes for tablet/desktop overrides
    - Accessibility: All interactive elements must include appropriate ARIA attributes (aria-label, aria-expanded, aria-controls)
    - Touch targets: All tap targets on mobile must be ≥44x44px (NFR-4.1)
    - Performance: UI interactions must provide feedback within 100ms (NFR-1.2), animations should complete in ≤300ms
    - File organization: Custom hooks go in src/hooks/, layout components in src/components/layout/
    - Import individual Lucide icons (import { Menu, X }) not wildcard imports for tree-shaking
  </constraints>

  <interfaces>
    <interface name="useMediaQuery" kind="custom-hook" signature="useMediaQuery(query: string): boolean" path="src/hooks/useMediaQuery.ts">
      Custom React hook that returns boolean indicating if media query matches current viewport. Uses window.matchMedia API. Updates on window resize. Example: useMediaQuery('(max-width: 767px)') returns true on mobile.
    </interface>

    <interface name="useLocation" kind="react-router-hook" signature="useLocation(): Location" path="react-router-dom">
      React Router hook that returns current location object with pathname property. Use to detect active route for navigation highlighting. Example: location.pathname === '/' for dashboard.
    </interface>

    <interface name="useState" kind="react-hook" signature="useState<T>(initialValue: T): [T, Dispatch<SetStateAction<T>>]" path="react">
      React hook for managing component state. Use for isMenuOpen boolean state. Example: const [isMenuOpen, setIsMenuOpen] = useState(false).
    </interface>

    <interface name="useEffect" kind="react-hook" signature="useEffect(effect: EffectCallback, deps?: DependencyList): void" path="react">
      React hook for side effects. Use for event listeners (Escape key, click outside), cleanup functions. Run effect when isMenuOpen or location changes.
    </interface>

    <interface name="useRef" kind="react-hook" signature="useRef<T>(initialValue: T): RefObject<T>" path="react">
      React hook for mutable ref object. Use for menuRef to detect clicks outside menu container. Attach to mobile menu div element.
    </interface>

    <interface name="Lucide Icons" kind="react-component" signature="<Menu size={number} className={string} />" path="lucide-react">
      Lucide React icon components. Import Menu and X icons. Menu for closed hamburger state, X for open state. Size prop for icon dimensions (24px recommended). ClassName for Tailwind styling.
    </interface>
  </interfaces>

  <tests>
    <standards>
      Manual testing required for responsive behavior and accessibility. Use Chrome DevTools for breakpoint testing (320px, 767px, 768px, 1023px, 1024px). Test on actual mobile devices if possible. Verify ARIA attributes with browser accessibility inspector. Use Lighthouse for WCAG AA compliance check. Test keyboard navigation without mouse.
    </standards>

    <locations>
      - Manual testing: Browser DevTools responsive mode
      - Accessibility testing: Browser DevTools accessibility inspector
      - Performance testing: Chrome DevTools Lighthouse
      - Cross-browser testing: Chrome, Firefox, Safari (desktop and mobile)
    </locations>

    <ideas>
      AC-5.1.1: Test breakpoint-based navigation
      - Open app at 320px width → verify hamburger visible, horizontal nav hidden
      - Resize to 768px → verify horizontal nav appears with compact spacing
      - Resize to 1024px → verify full horizontal nav bar
      - Verify no layout breaking at any intermediate width

      AC-5.1.2: Test mobile menu behavior
      - Click hamburger → verify menu slides in from left in ≤300ms
      - Click outside menu → verify menu closes
      - Press Escape key → verify menu closes
      - Click nav link → verify navigation occurs and menu closes
      - Verify smooth animation (no jank)

      AC-5.1.3: Test accessibility
      - Tab through navigation → verify focus visible on all links
      - Press Enter on focused link → verify navigation occurs
      - Inspect hamburger button → verify aria-label, aria-expanded, aria-controls present
      - Navigate to different route → verify active route highlighted
      - Test with keyboard only (no mouse)

      AC-5.1.4: Test touch targets
      - Open Chrome DevTools on mobile view
      - Measure all nav links and hamburger button
      - Verify all elements ≥44x44px tap target size
      - Test actual tap on mobile device for usability
    </ideas>
  </tests>
</story-context>
